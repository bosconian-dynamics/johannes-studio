{"ast":null,"code":"import { createSlice as createReduxSlice } from \"@reduxjs/toolkit\";\n\nconst defaultReducer = (state, action) => {\n  return state;\n};\n\nconst attachChildSlices = (parent, slices) => Object.values(slices).reduce((children, slice) => {\n  const name = slice.name;\n  slice = Object.assign({}, slice);\n\n  if (parent.children[name]) {\n    console.warn(`Slice \"${name}\" already registered as a child to this slice.`);\n    return children;\n  }\n\n  console.log(\"ATTACH CHILD SLICE\", slice);\n  slice.parent = parent;\n  slice.path.unshift(parent.name);\n  children[name] = slice;\n  parent.children[name] = slice;\n  parent.initial_state[name] = { ...parent.initial_state[name],\n    ...slice.initial_state\n  };\n  return children;\n}, {});\n\nexport const createSlice = (name, options = {}) => {\n  const {\n    children = {},\n    extra_reducers = {},\n    path = [name],\n    selectors = {},\n    ...slice_options\n  } = options;\n  const initial_state = Object.assign({}, options.initial_state);\n  const child_actions = {};\n  const child_reducers = {};\n  console.log(\"check 0\", children);\n\n  for (const child of Object.values(children)) {\n    child_reducers[child.name] = child.reducer;\n    child_actions[child.name] = child.actions;\n  }\n\n  console.log(\"check 1\");\n  const redux_slice = createReduxSlice({ ...slice_options,\n    name,\n    initialState: initial_state,\n    reducers: options.reducers,\n    extraReducers: builder => {\n      for (const [name, reducer] of Object.entries(child_reducers)) builder.addCase(name, reducer);\n\n      if (Array.isArray(extra_reducers)) {\n        for (const [reducerBuilder] of extra_reducers) reducerBuilder(builder);\n      } else if (typeof extra_reducers === \"function\") {\n        extra_reducers(builder);\n      } else if (typeof extra_reducers === \"object\") {\n        for (const [name, reducer] of Object.entries(extra_reducers)) builder.addCase(name, reducer);\n      } else {\n        throw new TypeError(\"Unknown extra_reducers format\");\n      }\n\n      builder.addDefaultCase(defaultReducer);\n    }\n  });\n  console.log(\"check 2\");\n  const slice = {\n    actions: { ...child_actions,\n      ...redux_slice.actions\n    },\n    case_reducers: redux_slice.caseReducers,\n    children: {},\n    initial_state,\n    name,\n    parent: null,\n    path,\n    reducer: redux_slice.reducer,\n    selectors\n  };\n  slice.attach = attachChildSlices.bind(null, slice);\n  console.log(\"check 3\");\n  attachChildSlices(slice, children);\n  console.log(\"check 4\");\n  return slice;\n};","map":{"version":3,"sources":["/sandbox/src/lib/data/slice/createSlice.js"],"names":["createSlice","createReduxSlice","defaultReducer","state","action","attachChildSlices","parent","slices","Object","values","reduce","children","slice","name","assign","console","warn","log","path","unshift","initial_state","options","extra_reducers","selectors","slice_options","child_actions","child_reducers","child","reducer","actions","redux_slice","initialState","reducers","extraReducers","builder","entries","addCase","Array","isArray","reducerBuilder","TypeError","addDefaultCase","case_reducers","caseReducers","attach","bind"],"mappings":"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","sourcesContent":["import { createSlice as createReduxSlice } from \"@reduxjs/toolkit\";\r\n\r\nconst defaultReducer = (state, action) => {\r\n  return state;\r\n};\r\n\r\nconst attachChildSlices = (parent, slices) =>\r\n  Object.values(slices).reduce((children, slice) => {\r\n    const name = slice.name;\r\n\r\n    slice = Object.assign({}, slice);\r\n\r\n    if (parent.children[name]) {\r\n      console.warn(\r\n        `Slice \"${name}\" already registered as a child to this slice.`\r\n      );\r\n      return children;\r\n    }\r\n\r\n    console.log(\"ATTACH CHILD SLICE\", slice);\r\n\r\n    slice.parent = parent;\r\n    slice.path.unshift(parent.name);\r\n\r\n    children[name] = slice;\r\n\r\n    parent.children[name] = slice;\r\n    parent.initial_state[name] = {\r\n      ...parent.initial_state[name],\r\n      ...slice.initial_state\r\n    };\r\n\r\n    return children;\r\n  }, {});\r\n\r\nexport const createSlice = (name, options = {}) => {\r\n  const {\r\n    children = {},\r\n    extra_reducers = {},\r\n    path = [name],\r\n    selectors = {},\r\n    ...slice_options\r\n  } = options;\r\n  const initial_state = Object.assign({}, options.initial_state);\r\n\r\n  const child_actions = {};\r\n  const child_reducers = {};\r\n\r\n  console.log(\"check 0\", children);\r\n\r\n  for (const child of Object.values(children)) {\r\n    child_reducers[child.name] = child.reducer;\r\n    child_actions[child.name] = child.actions;\r\n  }\r\n\r\n  console.log(\"check 1\");\r\n\r\n  const redux_slice = createReduxSlice({\r\n    ...slice_options,\r\n    name,\r\n    initialState: initial_state,\r\n    reducers: options.reducers,\r\n    extraReducers: (builder) => {\r\n      for (const [name, reducer] of Object.entries(child_reducers))\r\n        builder.addCase(name, reducer);\r\n\r\n      if (Array.isArray(extra_reducers)) {\r\n        for (const [reducerBuilder] of extra_reducers) reducerBuilder(builder);\r\n      } else if (typeof extra_reducers === \"function\") {\r\n        extra_reducers(builder);\r\n      } else if (typeof extra_reducers === \"object\") {\r\n        for (const [name, reducer] of Object.entries(extra_reducers))\r\n          builder.addCase(name, reducer);\r\n      } else {\r\n        throw new TypeError(\"Unknown extra_reducers format\");\r\n      }\r\n\r\n      builder.addDefaultCase(defaultReducer);\r\n    }\r\n  });\r\n\r\n  console.log(\"check 2\");\r\n\r\n  const slice = {\r\n    actions: {\r\n      ...child_actions,\r\n      ...redux_slice.actions\r\n    },\r\n    case_reducers: redux_slice.caseReducers,\r\n    children: {},\r\n    initial_state,\r\n    name,\r\n    parent: null,\r\n    path,\r\n    reducer: redux_slice.reducer,\r\n    selectors\r\n  };\r\n\r\n  slice.attach = attachChildSlices.bind(null, slice);\r\n\r\n  console.log(\"check 3\");\r\n\r\n  attachChildSlices(slice, children);\r\n\r\n  console.log(\"check 4\");\r\n\r\n  return slice;\r\n};\r\n"]},"metadata":{},"sourceType":"module"}